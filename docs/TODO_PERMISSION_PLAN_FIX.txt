TODO - Perbaikan Permission Menu Berdasarkan Paket Subscription & Addon
==========================================================================
Created: 6 Desember 2025

PLAN FEATURES SUMMARY:
----------------------
BASIC:
  - Products: 25
  - Users: 4 (1 admin + 2 kasir + 1 kitchen)
  - Outlets: 1
  - Access: ['kasir', 'laporan']
  - Addons included: ['receipt-basic']

PRO:
  - Products: 100
  - Users: 10 (1 admin + 1 supervisor + 6 kasir + 2 kitchen)
  - Outlets: 2
  - Access: ['kasir', 'laporan', 'manajemen-stok', 'addon-management']
  - Addons included: ['receipt-advanced', 'multi-outlet']

ENTERPRISE:
  - Products: Unlimited
  - Users: Unlimited
  - Outlets: Unlimited
  - Access: ['semua']
  - Addons included: ['receipt-advanced', 'multi-outlet']

ADDON TYPES:
------------
1. DELIVERY_MARKETING - Marketing & Delivery features
2. BUSINESS_ANALYTICS - Advanced Analytics & Financial Management
3. EXPORT_REPORTS - Export reports feature
4. RECEIPT_EDITOR - Custom receipt editor
5. ADD_PRODUCTS - Add more products limit
6. ADD_USERS - Add more users limit
7. ADD_OUTLETS - Add more outlets limit

ISSUES YANG DITEMUKAN:
----------------------
1. ⚠️ Inventory Menu tidak ada check plan feature
   - Location: TenantLayout.vue line 313-381
   - Current: Hanya check ADMIN_TENANT role
   - Problem: BASIC plan bisa akses Inventory padahal seharusnya hanya PRO/ENTERPRISE (access: 'manajemen-stok')
   - Should: Tambahkan check subscriptionPlan untuk PRO atau ENTERPRISE

2. ✅ Marketing & Delivery Menu - SUDAH BENAR
   - Location: TenantLayout.vue line 218
   - Check: hasDeliveryMarketing addon
   - Status: Correct ✅

3. ✅ Business Analytics Submenu - SUDAH BENAR
   - Location: TenantLayout.vue line 141, AppLayout.vue line 130
   - Check: hasBusinessAnalytics addon
   - Status: Correct ✅

4. ⚠️ AppLayout tidak load addons & subscription
   - Location: AppLayout.vue
   - Problem: Tidak ada loadAddons() atau loadSubscription()
   - Should: Load addons untuk check hasBusinessAnalytics

5. ⚠️ Route inventory tidak ada plan feature check
   - Routes: /app/inventory/suppliers, /app/inventory/purchase-orders, /app/inventory/stock-transfers, /app/inventory/stock-alerts
   - Problem: Hanya check role, tidak check plan feature 'manajemen-stok'
   - Should: Tambahkan middleware atau check di component

TASKS COMPLETED:
----------------
✅ 1. Tambahkan subscription plan check untuk Inventory menu
   - TenantLayout.vue - Added check plan feature 'manajemen-stok' (PRO/ENTERPRISE only) ✅
   - AppLayout.vue - No inventory menu (tidak perlu) ✅
   
✅ 2. Load subscription & addons di AppLayout
   - Added loadAddons() function ✅
   - Added activeAddons ref ✅
   - Added computed hasBusinessAnalytics ✅
   - Added computed hasDeliveryMarketing ✅
   - Load addons di onMounted dan watch userRole ✅

✅ 3. Tambahkan plan feature check di backend routes inventory
   - Created middleware: src/middlewares/plan-feature-guard.ts ✅
   - Added checkInventoryAccess untuk semua inventory routes ✅
   - Routes updated: suppliers, purchase-orders, stock-transfers, stock-alerts ✅

✅ 4. Load subscription di TenantLayout
   - Added loadSubscription() function ✅
   - Added currentSubscription ref ✅
   - Added computed hasInventoryAccess (PRO or ENTERPRISE) ✅
   - Load subscription di watch userRole ✅
   - Get plan from response.data.plan or response.data.subscriptionPlan ✅

TASKS TO COMPLETE:
------------------

4. Verifikasi semua menu visibility:
   
   MENU YANG HARUS ADA PER PLAN:
   
   BASIC (access: ['kasir', 'laporan']):
   ✅ Dashboard
   ✅ Produk (limit 25)
   ✅ Pesanan
   ✅ Pelanggan
   ✅ Laporan (basic)
   ✅ POS/Kasir
   ❌ Inventory (harus PRO/ENTERPRISE)
   ❌ Marketing (harus ada addon DELIVERY_MARKETING)
   ❌ Advanced Analytics (harus ada addon BUSINESS_ANALYTICS)
   ✅ Users (hanya ADMIN_TENANT)
   ✅ Stores (hanya ADMIN_TENANT, limit 1)
   
   PRO (access: ['kasir', 'laporan', 'manajemen-stok', 'addon-management']):
   ✅ Dashboard
   ✅ Produk (limit 100)
   ✅ Pesanan
   ✅ Pelanggan
   ✅ Laporan (basic + advanced jika ada addon)
   ✅ POS/Kasir
   ✅ Inventory (SUPPLIERS, PURCHASE_ORDERS, STOCK_TRANSFERS, STOCK_ALERTS)
   ❌ Marketing (harus ada addon DELIVERY_MARKETING)
   ❌ Advanced Analytics (harus ada addon BUSINESS_ANALYTICS)
   ✅ Users (hanya ADMIN_TENANT)
   ✅ Stores (hanya ADMIN_TENANT, limit 2)
   ✅ Addon Management (bisa beli addon)
   
   ENTERPRISE (access: ['semua']):
   ✅ Semua menu tersedia
   ✅ Unlimited products, users, outlets
   ✅ Inventory
   ❌ Marketing (harus ada addon DELIVERY_MARKETING)
   ❌ Advanced Analytics (harus ada addon BUSINESS_ANALYTICS)

5. Check semua route meta.roles dan requiresAddon:
   ✅ Delivery routes - requiresAddon: 'DELIVERY_MARKETING' ✅
   ✅ Marketing routes - requiresAddon: 'DELIVERY_MARKETING' ✅
   ✅ Analytics routes - requiresAddon: 'BUSINESS_ANALYTICS' ✅
   ✅ Inventory routes - checkInventoryAccess middleware added ✅

FILES MODIFIED:
---------------
✅ 1. client/src/layouts/TenantLayout.vue
   - Added currentSubscription ref
   - Added loadSubscription() function
   - Added computed: hasInventoryAccess (check PRO/ENTERPRISE plan)
   - Updated Inventory section: v-if="authStore.user?.role === 'ADMIN_TENANT' && hasInventoryAccess"
   - Load subscription di watch userRole

✅ 2. client/src/layouts/AppLayout.vue
   - Added loadAddons() function
   - Added activeAddons ref (removed duplicate)
   - Added computed: hasBusinessAnalytics, hasDeliveryMarketing
   - Load addons di onMounted dan watch userRole

✅ 3. src/middlewares/plan-feature-guard.ts (CREATED)
   - Middleware untuk check plan feature
   - checkPlanFeatureGuard() - generic middleware
   - checkInventoryAccess() - khusus untuk 'manajemen-stok'
   - Check tenant subscriptionPlan dan features via checkPlanFeature()

✅ 4. src/routes/supplier.routes.ts
   - Added checkInventoryAccess untuk semua routes (GET, POST, PUT, DELETE)

✅ 5. src/routes/purchase-order.routes.ts
   - Added checkInventoryAccess untuk semua routes (GET, POST, PUT, POST /receive, POST /cancel)

✅ 6. src/routes/stock-transfer.routes.ts
   - Added checkInventoryAccess untuk semua routes (GET, POST, POST /receive, POST /cancel)

✅ 7. src/routes/stock-alert.routes.ts
   - Added checkInventoryAccess untuk semua routes (GET /low-stock, GET /stats, POST /send)

✅ 8. client/src/views/stores/Stores.vue
   - Added permission check untuk tombol create/edit/delete (hanya ADMIN_TENANT)

FILES ALREADY CORRECT:
----------------------
✅ client/src/router/index.ts - Addon check sudah benar
✅ client/src/layouts/TenantLayout.vue - Marketing & Delivery check sudah benar
✅ client/src/layouts/TenantLayout.vue - Business Analytics check sudah benar
✅ src/middlewares/addon-guard.ts - Addon guard sudah benar
✅ src/services/plan-features.service.ts - Plan features sudah benar

SUMMARY PERBAIKAN:
------------------
✅ Menu Stores/Outlets:
   - Menu "Kelola Store" sudah ditambahkan di AppLayout.vue (section Manajemen)
   - Route permission: hanya ADMIN_TENANT dan SUPER_ADMIN
   - Backend: roleGuard untuk POST/PUT/DELETE
   - Frontend: permission check untuk tombol create/edit/delete

✅ Menu Inventory:
   - Visibility: hanya muncul untuk ADMIN_TENANT dengan plan PRO atau ENTERPRISE
   - Backend: checkInventoryAccess middleware untuk semua inventory routes
   - Frontend: hasInventoryAccess computed check di TenantLayout

✅ Menu Marketing & Delivery:
   - Visibility: hanya muncul jika ada addon DELIVERY_MARKETING
   - Backend: requiresAddon check di router
   - Frontend: hasDeliveryMarketing computed check

✅ Menu Business Analytics:
   - Visibility: submenu muncul jika ada addon BUSINESS_ANALYTICS
   - Backend: requiresAddon check di router (ADMIN_TENANT bypass untuk basic)
   - Frontend: hasBusinessAnalytics computed check

TESTING CHECKLIST:
------------------
⏳ 1. Test login sebagai ADMIN_TENANT dengan BASIC plan:
   - ✅ Menu Stores muncul
   - ❌ Menu Inventory TIDAK muncul
   - ❌ Submenu Business Analytics TIDAK muncul (jika tidak ada addon)
   - ❌ Menu Marketing TIDAK muncul (jika tidak ada addon)

⏳ 2. Test login sebagai ADMIN_TENANT dengan PRO plan:
   - ✅ Menu Stores muncul
   - ✅ Menu Inventory muncul
   - ❌ Submenu Business Analytics TIDAK muncul (jika tidak ada addon)
   - ❌ Menu Marketing TIDAK muncul (jika tidak ada addon)

⏳ 3. Test login sebagai ADMIN_TENANT dengan ENTERPRISE plan:
   - ✅ Menu Stores muncul
   - ✅ Menu Inventory muncul
   - ❌ Submenu Business Analytics TIDAK muncul (jika tidak ada addon)
   - ❌ Menu Marketing TIDAK muncul (jika tidak ada addon)

⏳ 4. Test dengan addon BUSINESS_ANALYTICS:
   - ✅ Submenu Business Analytics muncul di TenantLayout
   - ✅ Submenu Business Analytics muncul di AppLayout

⏳ 5. Test dengan addon DELIVERY_MARKETING:
   - ✅ Menu Marketing & Delivery muncul di TenantLayout

⏳ 6. Test API endpoints dengan plan berbeda:
   - BASIC plan: POST /api/suppliers harus return 403
   - PRO plan: POST /api/suppliers harus return 201/200
   - ENTERPRISE plan: POST /api/suppliers harus return 201/200

⏳ 7. Test login sebagai SUPERVISOR, CASHIER, KITCHEN:
   - ❌ Menu Stores TIDAK muncul
   - ❌ Menu Inventory TIDAK muncul
   - ✅ Menu sesuai permission masing-masing role
