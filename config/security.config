# Phase 31 - Security Hardening Configuration
# Comprehensive security configuration for Warungin Application
# Production-ready security measures

# ============================================================================
# 1. ENVIRONMENT VARIABLES - SECURITY
# ============================================================================

# API Security
API_RATE_LIMIT_WINDOW_MS=900000          # 15 minutes
API_RATE_LIMIT_MAX_REQUESTS=100          # requests per window
API_AUTH_RATE_LIMIT_MAX=5                # max login attempts
API_BULK_OP_RATE_LIMIT_MAX=10            # bulk operations per minute
API_SEARCH_RATE_LIMIT_MAX=30             # searches per minute

# Session Security
SESSION_SECRET=your-super-secret-key-change-in-production
SESSION_COOKIE_SECURE=true               # HTTPS only
SESSION_COOKIE_HTTPONLY=true             # no JavaScript access
SESSION_COOKIE_SAMESITE=strict           # CSRF protection
SESSION_COOKIE_MAX_AGE=3600000           # 1 hour

# JWT Security
JWT_SECRET=your-jwt-secret-change-in-production
JWT_EXPIRY=24h                           # token expiration
JWT_REFRESH_EXPIRY=7d                    # refresh token expiration
JWT_ALGORITHM=HS512                      # strong algorithm

# Password Policy
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL_CHARS=true
PASSWORD_EXPIRY_DAYS=90                  # force password change
PASSWORD_HISTORY_COUNT=5                 # prevent reuse

# CORS Configuration
CORS_ORIGIN=https://yourdomain.com       # production domain only
CORS_CREDENTIALS=true
CORS_MAX_AGE=3600

# Database Security
DB_SSL_ENABLED=true
DB_SSL_REJECT_UNAUTHORIZED=false         # verify certificate
DB_CONNECTION_POOL_MIN=5
DB_CONNECTION_POOL_MAX=20
DB_IDLE_TIMEOUT=30000
DB_QUERY_TIMEOUT=30000

# Redis Security
REDIS_PASSWORD=change-in-production
REDIS_TLS_ENABLED=true                   # for production
REDIS_TLS_REJECT_UNAUTHORIZED=false

# Logging & Audit
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=info                     # info, warning, error, critical
SECURITY_LOG_ENABLED=true
SENSITIVE_DATA_MASKING=true              # mask passwords, tokens, etc.
LOG_RETENTION_DAYS=90                    # GDPR compliance

# File Upload Security
UPLOAD_MAX_FILE_SIZE=10485760            # 10MB
UPLOAD_ALLOWED_TYPES=csv,json,xlsx      # whitelist only
UPLOAD_SCAN_FOR_MALWARE=true
UPLOAD_QUARANTINE_FOLDER=/uploads/quarantine

# Email Security
EMAIL_VERIFICATION_REQUIRED=true
EMAIL_VERIFICATION_TIMEOUT=3600          # 1 hour
EMAIL_RATE_LIMIT=5                       # emails per hour per user
TWO_FACTOR_AUTH_ENABLED=true
TWO_FACTOR_AUTH_METHOD=totp              # Time-based OTP

# API Key Security
API_KEY_ROTATION_DAYS=90
API_KEY_MIN_LENGTH=32
API_KEY_HASH_ALGORITHM=sha512

# Encryption
ENCRYPTION_ALGORITHM=aes-256-gcm
ENCRYPTION_KEY_ROTATION_DAYS=365
FIELD_ENCRYPTION_ENABLED=true            # encrypt sensitive fields

# ============================================================================
# 2. SECURITY HEADERS
# ============================================================================

Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; object-src 'none'; media-src 'self'; frame-src 'self'

X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=(), payment=()

Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate
Pragma: no-cache
Expires: 0

# ============================================================================
# 3. AUTHENTICATION & AUTHORIZATION
# ============================================================================

[Authentication]
Method=JWT with refresh tokens
MFA_Enabled=true
MFA_Methods=TOTP, SMS, Email
Session_Timeout=3600              # 1 hour
Idle_Timeout=1800                 # 30 minutes
Max_Concurrent_Sessions=3

[Authorization]
RBAC_Enabled=true
Roles=admin, manager, outlet_staff, viewer
Fine_Grained_Permissions=true
Permission_Caching=true
Cache_TTL=300                      # 5 minutes

[Account_Security]
Account_Lockout_Enabled=true
Lockout_Duration=1800              # 30 minutes
Failed_Attempts_Threshold=5
Account_Expiry_Enabled=true
Account_Expiry_Days=365
Inactive_Account_Lockout_Days=90

# ============================================================================
# 4. INPUT VALIDATION & SANITIZATION
# ============================================================================

[Input_Validation]
Max_String_Length=10000
Max_Array_Length=1000
Max_Object_Depth=5
Whitelist_Mode=true
Validate_All_Inputs=true

[XSS_Prevention]
HTML_Sanitization=enabled
Script_Tag_Removal=enabled
Event_Handler_Removal=enabled
Data_URI_Blocking=enabled

[SQL_Injection_Prevention]
Parameterized_Queries=required
Query_Validation=enabled
Statement_Preparation=required
Dynamic_SQL_Disabled=true

[NoSQL_Injection_Prevention]
MongoDB_Sanitization=enabled
Key_Validation=enabled
Value_Validation=enabled
Operator_Filtering=enabled

# ============================================================================
# 5. API SECURITY
# ============================================================================

[Rate_Limiting]
Global_Limit=100 requests per 15 minutes
Auth_Limit=5 attempts per 15 minutes
API_Limit=60 requests per minute
Bulk_Ops_Limit=10 operations per minute
Import_Export_Limit=5 operations per minute
Search_Limit=30 searches per minute

[API_Versioning]
Current_Version=v1
Deprecated_Versions_Support=false
Version_Sunset_Notice=6 months

[API_Documentation]
Swagger_UI_Enabled=true
API_Docs_Protected=true
API_Docs_Require_Auth=true

# ============================================================================
# 6. DATA PROTECTION & ENCRYPTION
# ============================================================================

[Data_Encryption]
In_Transit=TLS 1.3 mandatory
At_Rest=AES-256-GCM
Field_Encryption=enabled on: password, ssn, credit_card, phone, email

[Sensitive_Fields]
Encrypted_Fields=password, tokens, api_keys, secret_keys, ssn, phone_number
Masked_Fields=credit_cards (show last 4 digits only), ssn (show last 4 digits)
Redacted_Fields=passwords (never logged), tokens (never logged)

[Data_Minimization]
Collect_Only_Required_Data=true
Data_Retention=90 days for audit logs, 1 year for transactions
Data_Anonymization=enabled
GDPR_Compliance=enabled

# ============================================================================
# 7. MONITORING & LOGGING
# ============================================================================

[Security_Monitoring]
Monitor_Failed_Logins=true
Monitor_Permission_Changes=true
Monitor_Data_Access=true
Monitor_Admin_Actions=true
Monitor_Bulk_Operations=true
Alert_On_Suspicious_Activity=true

[Audit_Logging]
Log_User_Actions=true
Log_Data_Changes=true
Log_Permission_Changes=true
Log_System_Changes=true
Log_Failed_Auth_Attempts=true
Log_Rate_Limit_Violations=true
Log_File_Uploads=true
Log_Exports=true

[Alerting]
Alert_Multiple_Failed_Logins=true
Alert_Permission_Escalation=true
Alert_Bulk_Data_Deletion=true
Alert_Unusual_API_Activity=true
Alert_High_Error_Rate=true

# ============================================================================
# 8. INFRASTRUCTURE SECURITY
# ============================================================================

[Docker_Security]
Non_Root_User=true
Read_Only_Filesystem=true
No_New_Privileges=true
Security_Opts=no-new-privileges:true
Cap_Drop=ALL
Cap_Add=NET_BIND_SERVICE

[Network_Security]
Internal_Communication_Only=true
Service_to_Service_Auth=true
Network_Isolation=enabled
Firewall_Rules=whitelist only

[Database_Security]
Connection_Encryption=TLS 1.3
Credential_Rotation=90 days
Backup_Encryption=AES-256
Backup_Location=secure, offsite storage
Point_in_Time_Recovery=enabled

[Redis_Security]
Connection_Encryption=TLS 1.3
ACL_Enabled=true
Command_Restrictions=enabled
Key_Expiration=enabled

# ============================================================================
# 9. DEPENDENCY SECURITY
# ============================================================================

[Dependency_Management]
npm_Audit_Frequency=daily
Automatic_Patch_Updates=enabled
Major_Version_Review=required
Security_Patch_Lag=maximum 7 days
SBOM_Generation=enabled

[Vulnerable_Packages]
Auto_Update=critical
Manual_Review=high, medium

# ============================================================================
# 10. COMPLIANCE & STANDARDS
# ============================================================================

[Standards_Compliance]
OWASP_Top_10=implemented
OWASP_API_Top_10=implemented
PCI_DSS=compliant
GDPR=compliant
ISO_27001=target

[Security_Testing]
Penetration_Testing=quarterly
Vulnerability_Scanning=weekly
Security_Code_Review=per release
Dependency_Audit=weekly
Configuration_Audit=monthly

# ============================================================================
# 11. INCIDENT RESPONSE
# ============================================================================

[Incident_Response]
Contact_Email=security@warungin.com
Response_Time_SLA=1 hour for critical
Escalation_Procedure=enabled
Post_Incident_Review=required
Breach_Notification_Enabled=true

# ============================================================================
# 12. SECURITY TESTING ENDPOINTS (Development Only)
# ============================================================================

# NOTE: These endpoints should ONLY be enabled in development/staging
# NEVER enable in production

Development_Mode=false

[Test_Endpoints]
Test_XSS_Endpoint=disabled              # POST /api/test/xss
Test_SQL_Injection=disabled             # POST /api/test/sql-injection
Test_Auth_Bypass=disabled               # POST /api/test/auth-bypass
Test_Rate_Limit=disabled                # POST /api/test/rate-limit
Test_CSRF=disabled                      # POST /api/test/csrf
