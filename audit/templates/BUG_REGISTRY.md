# Bug Registry Template

Use one row per bug.

| Bug ID      | Severity    | Area                  | Journey                          | File/Module                                                                                                              | Repro Steps                                                                                   | Expected                                                                                                           | Actual                                                                                                                          | Root Cause                                                                                | Fix Plan                                                                                                           | Owner                                                                            | Status                                                                | Evidence                                                                                                                                                                                                                                                         |
| ----------- | ----------- | --------------------- | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----- | ----------------------------------------------------------- |
| WG-AUD-0001 | P0-Critical | FE-BE Contract        | Super Admin multi-tenant routing | `client/src/api/index.ts`, `nest/src/common/guards/tenant.guard.ts`, `nest/src/common/decorators/tenant-id.decorator.ts` | 1) Login as SUPER_ADMIN 2) Select tenant in UI 3) Request `/products`                         | Selected tenant context should be applied server-side                                                              | Backend tenant resolver only reads `request.tenantId` or `x-tenant-id`; frontend sends query `tenantId` only                    | Tenant context propagation mismatch between frontend interceptor and backend tenant guard | Add unified tenant resolver that accepts header and validated query/source, and standardize one transport contract | Audit                                                                            | Fixed                                                                 | `client/src/api/index.ts:94`, `nest/src/common/guards/tenant.guard.ts:46`, `nest/src/common/decorators/tenant-id.decorator.ts:17`                                                                                                                                |
| WG-AUD-0002 | P0-Critical | Auth/Shift            | Cashier shift gate               | `nest/src/modules/cash-shifts/cash-shifts.controller.ts`, `client/src/stores/auth.ts`, `client/src/router/index.ts`      | 1) Cashier without active shift calls `/cash-shift/current` 2) Navigate protected route       | User without active shift must be redirected to open shift                                                         | API returns `{ message: 'No active shift' }` with 200; frontend treats object as active shift due `!shiftStatus                 |                                                                                           | shiftStatus.shiftEnd` logic                                                                                        | Contract mismatch for no-shift state (null/404 expected by frontend cache logic) | Normalize API to explicit no-shift contract and align guard condition | Audit                                                                                                                                                                                                                                                            | Fixed | `nest/src/modules/cash-shifts/cash-shifts.controller.ts:72` |
| WG-AUD-0003 | P1-Major    | Build/Dependency      | Backend installation             | `nest/package.json`                                                                                                      | 1) Run `npm ci` in `nest/` on clean machine                                                   | Dependencies install cleanly                                                                                       | `npm ci` fails with peer conflict `@nestjs/serve-static@5.0.4` requiring Nest 11                                                | Version matrix drift between Nest core v10 and serve-static package                       | Pin compatible `@nestjs/serve-static` for Nest 10 and refresh lockfile                                             | Audit                                                                            | Fixed                                                                 | `nest/package.json:24`, `nest/package-lock.json`, verified `npm ci` success in `nest/`                                                                                                                                                                           |
| WG-AUD-0004 | P1-Major    | FE-BE Connectivity    | Local/dev API routing            | `client/src/api/index.ts`, `nest/src/main.ts`, `docker-compose.yml`                                                      | 1) Start backend default config 2) Start frontend without `VITE_API_URL`                      | Frontend should call active backend API                                                                            | Frontend default baseURL uses `http://localhost:3001/api` while backend listens on `3000`                                       | Default API port drift after backend runtime changes                                      | Unify default ports and enforce via env validation in frontend startup                                             | Audit                                                                            | Fixed                                                                 | `client/src/api/index.ts:25`, `nest/src/main.ts:85`, `docker-compose.yml:151`                                                                                                                                                                                    |
| WG-AUD-0005 | P0-Critical | Security/Auth         | Token verification path          | `nest/src/modules/auth/auth.controller.ts`, `nest/src/modules/auth/auth.service.ts`                                      | 1) Call `/auth/me` with invalid/missing token 2) Observe auth behavior                        | Invalid/missing token should fail consistently (401) with no fallback secrets                                      | `/auth/me` is public and service fallback uses hardcoded JWT secret when env missing                                            | Weak auth hardening and inconsistent unauthorized behavior path                           | Remove fallback secret, make unauthorized explicit, and enforce guard-compatible `/auth/me` semantics              | Audit                                                                            | Fixed                                                                 | `nest/src/modules/auth/auth.controller.ts:38`, `nest/src/modules/auth/auth.service.ts:275`                                                                                                                                                                       |
| WG-AUD-0006 | P1-Major    | Security/Supply Chain | Frontend dependency health       | `client/package-lock.json`                                                                                               | 1) Run `npm ci` in `client/` 2) Run `npm audit`                                               | Dependency tree should be within accepted risk                                                                     | After `npm audit fix` and toolchain hardening, vulnerabilities are resolved                                                     | Transitive dependency risk from minimatch/jspdf chain                                     | Pin patched dependency graph using overrides and updated lockfile                                                  | Audit                                                                            | Fixed                                                                 | `client/package-lock.json`, `client/package.json:49`, `npm audit --audit-level=high` shows `found 0 vulnerabilities`                                                                                                                                             |
| WG-AUD-0007 | P2-Minor    | Code Quality          | Frontend maintainability         | `client/src/**`                                                                                                          | 1) Run `npm run lint`                                                                         | Low warning count in critical modules                                                                              | 180 warnings (unused symbols), high noise around POS/layout/report modules                                                      | Refactor debt after reskin and partial feature merges                                     | Clean warnings in critical modules first to reduce false negatives during future audits                            | Audit                                                                            | Open                                                                  | `audit/reports/static/20260223-194251/client-lint.txt:347`                                                                                                                                                                                                       |
| WG-AUD-0008 | P1-Major    | Frontend Routing      | App route resolution             | `client/src/router/index.ts`                                                                                             | 1) Load router with current route table 2) Navigate by named route `stores`                   | One deterministic route config per route name/path                                                                 | Duplicate named route `stores` appears twice with different role metadata                                                       | Route table duplication during reskin merge causing ambiguous/overridden behavior         | De-duplicate route definitions and keep one canonical `stores` config                                              | Audit                                                                            | Fixed                                                                 | `client/src/router/index.ts:297`                                                                                                                                                                                                                                 |
| WG-AUD-0009 | P0-Critical | Deployment/Runtime    | Environment validation           | Remote runtime service topology                                                                                          | 1) Check active runtime on target host 2) Probe expected health endpoints                     | Running runtime should match Warungin service contracts                                                            | Active frontend/backend on host responds as different app contract (Next.js-like frontend and missing expected health routes)   | Deployment target drift; runtime not aligned with audited repository                      | Enforce deployment identity checks (service name, commit, endpoint contract) before release audit gates            | Audit                                                                            | Fixed                                                                 | Warungin runtime verified healthy on public domains after Coolify deploys `71-76`: `https://warungin.faiznute.site` serves frontend and `https://warungin-api.faiznute.site/health` returns expected identity payload (`appName=warungin-backend`, DB connected) |
| WG-AUD-0010 | P0-Critical | Data Integrity        | Order creation pipeline          | `nest/src/modules/orders/orders.service.ts`, `prisma/schema.prisma`                                                      | 1) Create order via `/orders` with current service path 2) Validate persisted required fields | Order record should include required schema fields (`orderNumber`, `userId`, `subtotal`) and match schema contract | Service creates order with partial data and `as any`, bypassing compile checks and risking runtime failure/inconsistent records | Order service implementation drift from Prisma schema + unsafe `any` casting              | Align create path with schema-required fields and remove unsafe casts on critical writes                           | Audit                                                                            | Fixed                                                                 | `nest/src/modules/orders/orders.service.ts:114`, `nest/src/modules/orders/orders.service.ts:120`, `nest/src/modules/orders/orders.service.ts:152`                                                                                                                |
| WG-AUD-0011 | P0-Critical | Data Integrity        | Stock consistency                | `nest/src/modules/orders/orders.service.ts`                                                                              | 1) Create order flow 2) Cancel same order 3) Compare stock                                    | Stock should return to exact pre-order value                                                                       | Cancel flow always increments stock while no corresponding decrement exists in order creation flow                              | Asymmetric stock mutation logic can inflate inventory counts                              | Introduce symmetric stock reservation/commit model with transaction boundaries                                     | Audit                                                                            | Fixed                                                                 | `nest/src/modules/orders/orders.service.ts:168`, `nest/src/modules/orders/orders.service.ts:286`                                                                                                                                                                 |
| WG-AUD-0012 | P1-Major    | Backend Domain Model  | Order lifecycle states           | `nest/src/modules/orders/orders.service.ts`, `prisma/schema.prisma`                                                      | 1) Execute bulk delete/delete endpoints 2) Persist status                                     | Status transitions must stay within enum domain                                                                    | Service writes status `DELETED` not present in `OrderStatus` enum                                                               | Invalid domain value usage hidden by `as any` can break runtime and reporting             | Replace soft-delete strategy with valid state model (e.g., cancelled/archive flag)                                 | Audit                                                                            | Fixed                                                                 | `nest/src/modules/orders/orders.service.ts:506`, `nest/src/modules/orders/orders.service.ts:517`, `prisma/schema.prisma:221`                                                                                                                                     |
| WG-AUD-0013 | P1-Major    | Payment Reliability   | Callback idempotency             | `nest/src/modules/payments/payments.service.ts`                                                                          | 1) Receive callback for `order_id` 2) Receive duplicate callback for same payment             | Duplicate callbacks should resolve idempotently                                                                    | Lookup key changes from `order_id` to `transaction_id` after first update, breaking repeat callback lookup                      | Reference mutation breaks callback idempotency contract                                   | Keep immutable external order reference and store gateway transaction id in separate field                         | Audit                                                                            | Fixed                                                                 | `nest/src/modules/payments/payments.service.ts:204`, `nest/src/modules/payments/payments.service.ts:238`                                                                                                                                                         |
| WG-AUD-0014 | P1-Major    | Reskin Regression     | POS success UX flow              | `client/src/views/pos/POS.vue`                                                                                           | 1) Complete payment in POS 2) Observe success overlay rendering                               | Exactly one success modal/overlay should render per success state                                                  | Two separate template blocks render on same state `showSuccessOverlay`                                                          | Merge artifacts from reskin causing duplicate UI layer behavior                           | Consolidate to one success overlay component/state path                                                            | Audit                                                                            | Fixed                                                                 | `client/src/views/pos/POS.vue:625`, `client/src/views/pos/POS.vue:741`                                                                                                                                                                                           |
| WG-AUD-0015 | P1-Major    | Performance           | Frontend bundle profile          | `audit/reports/static/20260223-194251/client-build.txt`                                                                  | 1) Build frontend 2) Inspect chunk sizes                                                      | Critical chunks should remain within performance budget                                                            | Multiple vendor chunks exceed large-size thresholds (e.g. ~540k JS) increasing load time risk                                   | Bundle splitting strategy and heavy dependencies not budgeted for cashier-critical flows  | Define bundle budgets and split lazy boundaries for heavy report/pdf/chart dependencies                            | Audit                                                                            | Fixed                                                                 | `client/vite.config.js:141`, build output 2026-02-23 shows `jspdf-vendor` 340k and `html2canvas-vendor` 199k                                                                                                                                                     |
| WG-AUD-0016 | P1-Major    | Deployment Security   | Container privilege boundary     | `docker-compose.yml`                                                                                                     | 1) Review backend container mounts 2) Assess runtime capabilities                             | App container should follow least privilege and avoid host control channels                                        | Backend mounts Docker socket (`/var/run/docker.sock`) even in app runtime                                                       | Privilege escalation path and host control surface exposed to app compromise              | Remove docker socket mount from app runtime or isolate behind dedicated service                                    | Audit                                                                            | Fixed                                                                 | `docker-compose.yml:177` removed from backend service; only promtail retains docker socket at `docker-compose.yml:332`                                                                                                                                           |
| WG-AUD-0017 | P2-Minor    | Testing Coverage      | Regression confidence            | `client/cypress/e2e/*.cy.ts`, repo test config                                                                           | 1) Inventory automated tests 2) Compare against critical journeys                             | Critical journeys should be covered by repeatable automated tests                                                  | Current suite is sparse (3 Cypress specs, no evident unit/integration harness) for broad module surface                         | Test strategy lagging behind feature and reskin scope                                     | Add golden-path test matrix for auth/POS/payment/reporting and guard rules                                         | Audit                                                                            | Open                                                                  | `client/cypress/e2e/auth.cy.ts`, `client/cypress/e2e/outlets-advanced.cy.ts`, `client/cypress/e2e/phase29-e2e.cy.ts`                                                                                                                                             |

## Status Values

- Open
- In Progress
- Blocked
- Fixed
- Verified
- Closed

## Notes

- Keep repro deterministic.
- If root cause is uncertain, mark as `Needs Investigation`.
- Reference related bugs to avoid duplicate fixes.
